<template>
  <div
    ref="containerRef"
    class="scroll-button grid justify-end"
    data-hover-text="Scroll"
  >
    <svg
      class="w-24 h-24 md:w-28 md:h-28 lg:w-32 lg:h-32"
      viewBox="0 0 120 120"
      fill="none"
      xmlns="http://www.w3.org/2000/svg"
    >
      <!-- Circular "Scroll" text -->
      <path
        ref="textRef"
        class="scroll-button__text"
        d="M54.845 110.651c1.103.089 1.953.576 2.55 1.461l-.854.643c-.453-.679-1.069-1.05-1.846-1.113-.465-.037-.83.04-1.093.233-.27.199-.42.484-.45.856-.025.306.046.549.212.73.165.187.457.338.876.452l.627.181c.7.191 1.217.467 1.549.828.325.367.464.837.418 1.408-.053.645-.323 1.134-.812 1.469-.488.335-1.121.472-1.899.409-1.063-.086-1.846-.528-2.35-1.324l.842-.614c.375.572.924.887 1.649.946.438.035.781-.027 1.028-.188.247-.154.384-.397.41-.729.026-.313-.048-.556-.221-.73-.174-.175-.47-.323-.888-.443l-.638-.172c-.718-.212-1.23-.498-1.536-.857-.312-.36-.445-.825-.398-1.397a2.24 2.24 0 0 1 .415-1.17c.234-.322.557-.56.971-.714.414-.154.893-.209 1.438-.165Zm-7.468-1.331c.934.221 1.59.705 1.968 1.452.37.752.415 1.719.136 2.899-.188.792-.464 1.439-.83 1.941-.372.502-.816.845-1.333 1.031-.517.186-1.08.207-1.69.062-1.207-.285-1.92-1.02-2.14-2.202l1.034-.289c.114.821.56 1.324 1.339 1.508.558.133 1.046.039 1.464-.28.41-.314.695-.811.857-1.492l.253-1.071c.16-.675.126-1.241-.101-1.699-.235-.453-.632-.746-1.19-.878-.408-.096-.778-.071-1.107.077-.337.147-.62.391-.852.734l-.76-.745c.365-.469.8-.798 1.303-.987.496-.184 1.046-.204 1.649-.061Zm-7.637.748 1.151-2.748 1.043.437-2.834 6.76-2.887-1.21c-.596-.25-.992-.626-1.187-1.127-.194-.5-.162-1.061.099-1.682.206-.492.49-.858.85-1.097.358-.233.776-.318 1.256-.254l-.268-3.474 1.162.487.222 3.325 1.392.583Zm-2.143.143c-.282-.118-.535-.137-.756-.057-.23.084-.405.268-.524.551l-.193.461c-.119.283-.126.533-.022.75.096.221.285.39.568.509l1.77.742.928-2.213-1.77-.743Zm-5.497-7.645c.532.344.917.768 1.156 1.271.238.503.312 1.064.223 1.681-.095.613-.362 1.258-.8 1.936-.438.677-.917 1.185-1.437 1.523-.53.341-1.07.507-1.622.5-.556-.011-1.103-.19-1.64-.537-.538-.348-.923-.771-1.156-1.271-.238-.503-.31-1.062-.215-1.675.09-.617.355-1.267.797-1.95.438-.678.92-1.184 1.446-1.518.52-.339 1.059-.502 1.616-.492.55.007 1.095.185 1.633.532Zm-.556.843c-.493-.319-.992-.407-1.496-.265-.514.144-.956.502-1.325 1.073l-.624.965c-.37.571-.513 1.118-.43 1.64.074.524.358.946.85 1.264.493.319.999.408 1.519.267.51-.138.95-.493 1.319-1.064l.624-.965c.37-.571.514-1.121.435-1.649-.089-.525-.38-.948-.872-1.266Zm-8.767-6.951.673-.74 3.055 2.78-4.934 5.422-.836-.761 4.26-4.681-2.218-2.02Zm-4.687-5.513.769-.638 2.639 3.176-5.638 4.684-.722-.869 4.868-4.045-1.916-2.308Zm-6.02-7.285c.107.214.136.404.086.571-.054.162-.173.288-.357.381l-.143.072c-.185.093-.358.113-.519.06-.17-.057-.309-.192-.417-.407-.104-.209-.127-.395-.068-.559.05-.167.168-.297.353-.39l.143-.071a.684.684 0 0 1 .518-.06c.162.054.296.188.404.402Zm-1.73-12.642c.261 1.076.065 2.035-.587 2.88l-.879-.61c.503-.644.662-1.344.478-2.102-.11-.454-.298-.775-.563-.965-.273-.194-.592-.247-.954-.16-.298.073-.507.216-.627.43-.126.216-.177.54-.155.974l.025.653c.038.725-.062 1.301-.301 1.73-.247.423-.65.702-1.207.837-.628.153-1.178.05-1.65-.31-.47-.359-.798-.917-.982-1.675-.251-1.037-.077-1.92.521-2.648l.847.608c-.426.535-.553 1.156-.382 1.862.104.428.27.734.5.918.224.186.498.24.822.161.304-.073.512-.22.624-.44.111-.218.159-.545.143-.98l-.037-.66c-.024-.75.087-1.325.332-1.727.244-.41.645-.681 1.202-.816a2.24 2.24 0 0 1 1.242.028c.379.12.706.353.982.698.275.345.478.783.607 1.314Zm-1.074-7.51c.082.957-.172 1.732-.763 2.325-.599.587-1.502.932-2.711 1.037-.81.07-1.511.01-2.103-.18-.593-.196-1.058-.51-1.397-.943-.338-.433-.534-.961-.588-1.586-.107-1.235.367-2.142 1.421-2.722l.599.892c-.745.365-1.083.947-1.014 1.743.05.572.291 1.006.725 1.303.426.291.988.407 1.686.346l1.096-.094c.69-.06 1.218-.27 1.582-.629.356-.365.51-.833.46-1.405-.036-.418-.176-.76-.42-1.027a1.984 1.984 0 0 0-.963-.58l.47-.953c.559.199 1.007.508 1.345.927.33.413.521.929.575 1.546ZM6.162 56.49l2.97.233-.088 1.126-7.307-.573.245-3.12c.05-.645.283-1.139.698-1.48.414-.343.957-.487 1.629-.434.531.041.967.196 1.307.463.334.267.545.638.635 1.113l3.215-1.342-.099 1.256-3.087 1.252-.118 1.506Zm-.807-1.99c.024-.305-.037-.55-.183-.736-.152-.193-.38-.3-.687-.325l-.498-.039c-.306-.024-.545.047-.719.214-.18.16-.282.393-.306.699l-.15 1.914 2.393.188.15-1.915Zm5.539-7.615c-.16.613-.442 1.111-.845 1.495-.404.384-.913.63-1.526.739-.613.102-1.31.05-2.09-.153-.78-.204-1.413-.5-1.897-.888-.489-.397-.816-.858-.982-1.383-.165-.532-.166-1.108-.004-1.727.161-.62.443-1.118.845-1.495.403-.384.911-.627 1.523-.729.614-.108 1.315-.06 2.102.146.78.203 1.412.503 1.894.897.485.389.809.849.973 1.38.166.527.168 1.099.007 1.718Zm-.975-.265c.148-.567.076-1.068-.217-1.503-.298-.443-.776-.75-1.434-.922l-1.113-.29c-.658-.172-1.221-.137-1.691.105-.475.235-.786.636-.934 1.203-.149.568-.075 1.076.221 1.526.292.441.766.748 1.424.92l1.113.29c.658.172 1.225.137 1.701-.104.472-.249.782-.657.93-1.225Zm3.854-10.502.913.408-1.683 3.771-6.694-2.988.461-1.031 5.78 2.58 1.223-2.74Zm3.767-6.178.848.53-2.19 3.5-6.214-3.886.599-.958 5.367 3.357 1.59-2.544Zm5.034-8c-.17.17-.342.256-.517.26-.17 0-.327-.073-.473-.219l-.113-.113c-.146-.146-.22-.304-.219-.474 0-.18.085-.354.255-.523.165-.165.335-.245.51-.24.174-.005.334.066.48.213l.113.113c.142.142.214.3.219.474 0 .17-.085.34-.255.509Zm11.464-5.602c-.94.584-1.913.699-2.92.343l.305-1.025c.768.276 1.484.208 2.146-.204.396-.247.643-.526.74-.837.098-.32.05-.64-.148-.957-.162-.26-.364-.413-.604-.46-.245-.052-.57 0-.974.158l-.612.228c-.676.263-1.255.349-1.737.256-.48-.102-.87-.397-1.173-.883-.342-.55-.416-1.104-.223-1.664.194-.56.621-1.046 1.284-1.458.905-.564 1.798-.675 2.677-.335l-.312.995c-.641-.237-1.27-.163-1.888.22-.373.233-.612.487-.715.764-.106.27-.072.547.104.83.166.266.37.417.613.455.243.037.569-.02.977-.172l.615-.242c.704-.257 1.285-.332 1.744-.225.465.104.849.399 1.152.885.24.385.36.781.362 1.188a2.04 2.04 0 0 1-.355 1.152c-.241.37-.594.699-1.058.988Zm6.794-3.373c-.882.378-1.698.379-2.446.003-.745-.384-1.356-1.134-1.834-2.25-.32-.747-.483-1.431-.488-2.053 0-.624.154-1.165.458-1.622.305-.456.745-.808 1.321-1.055 1.14-.488 2.15-.323 3.03.497l-.658.848c-.58-.593-1.239-.732-1.974-.417-.527.226-.864.592-1.01 1.097-.142.496-.076 1.066.2 1.71l.433 1.01c.273.638.637 1.073 1.092 1.306.459.224.951.223 1.478-.003.387-.165.668-.405.845-.72.183-.318.266-.684.248-1.097l1.053.147c-.014.594-.167 1.117-.46 1.568-.288.443-.718.787-1.288 1.03Zm5.693-5.146.71 2.894-1.098.269-1.745-7.12 3.04-.744c.629-.154 1.17-.088 1.625.199.454.286.762.757.922 1.41.127.519.117.981-.03 1.388-.15.4-.436.717-.859.952l2.282 2.632-1.224.3-2.156-2.54-1.467.36Zm1.637-1.39c.297-.073.512-.208.642-.404.135-.205.166-.456.093-.754l-.119-.486c-.073-.298-.216-.503-.429-.615-.208-.121-.46-.145-.758-.072l-1.865.457.57 2.331 1.866-.457Zm8.967 2.874c-.633.04-1.194-.071-1.685-.334-.49-.263-.884-.669-1.18-1.218-.288-.55-.458-1.227-.509-2.032-.05-.805.032-1.498.25-2.08.223-.588.558-1.044 1.005-1.366.454-.323 1-.504 1.639-.545.639-.04 1.2.071 1.684.334.491.263.881.67 1.17 1.219.295.55.468 1.23.52 2.041.05.805-.036 1.499-.26 2.08-.216.582-.552 1.034-1.006 1.357-.447.322-.99.504-1.628.544Zm-.054-1.009c.585-.037 1.038-.262 1.36-.677.327-.421.47-.971.426-1.65l-.072-1.148c-.044-.678-.254-1.203-.631-1.573-.371-.377-.85-.548-1.435-.51-.586.037-1.046.266-1.38.688-.327.415-.47.962-.427 1.64l.073 1.148c.043.679.253 1.206.631 1.583.384.37.87.537 1.455.5Zm11.181.371-.1.995-4.11-.417.74-7.293 1.125.114-.64 6.298 2.985.303Zm7.048 1.642-.238.971-4.011-.982 1.744-7.12 1.098.27-1.507 6.147 2.914.714Zm9.173 2.274c-.214-.108-.35-.244-.41-.409-.052-.16-.032-.334.061-.518l.072-.143c.093-.184.22-.303.382-.356.17-.056.362-.03.576.079.209.105.338.241.388.408a.642.642 0 0 1-.052.523l-.072.143a.684.684 0 0 1-.382.356c-.16.053-.349.026-.563-.083Zm8.912 9.132c-.85-.71-1.263-1.597-1.24-2.664l1.068-.033c-.021.816.268 1.474.867 1.974.358.3.7.446 1.026.44.335-.006.623-.153.862-.44.197-.235.28-.474.248-.717-.027-.249-.179-.54-.455-.875l-.408-.51c-.462-.56-.725-1.083-.787-1.57-.054-.487.103-.95.47-1.39.415-.497.919-.741 1.51-.733.593.008 1.189.262 1.788.762.819.684 1.204 1.496 1.156 2.438l-1.042.015c.024-.683-.243-1.258-.801-1.724-.338-.282-.654-.428-.949-.44-.29-.016-.542.104-.755.36-.201.24-.281.481-.24.724.04.242.197.534.469.873l.422.51c.464.587.718 1.115.76 1.585.047.474-.113.93-.48 1.37-.29.349-.629.588-1.015.717a2.04 2.04 0 0 1-1.205.023c-.426-.113-.85-.345-1.27-.695Zm5.331 5.397c-.635-.72-.891-1.494-.77-2.323.133-.828.653-1.643 1.563-2.446.609-.539 1.208-.908 1.797-1.107.593-.195 1.154-.219 1.684-.073.529.147 1.001.455 1.416.924.821.93.98 1.941.477 3.034l-1.012-.36c.382-.737.307-1.405-.222-2.005-.38-.43-.832-.635-1.358-.616-.516.02-1.036.262-1.561.725l-.824.728c-.52.459-.82.941-.898 1.446-.069.506.086.974.466 1.404.278.315.594.507.949.576.359.074.732.038 1.119-.108l.19 1.046c-.568.173-1.113.191-1.633.055-.511-.136-.972-.436-1.382-.9Zm6.671 3.794-2.526 1.58-.6-.958 6.215-3.887 1.66 2.654c.343.548.449 1.083.319 1.604-.13.522-.48.961-1.051 1.318-.452.283-.894.418-1.327.405-.427-.016-.817-.188-1.172-.516l-1.785 2.992-.669-1.069 1.737-2.843-.801-1.28Zm1.832 1.118c.163.26.358.421.585.483.237.065.486.015.746-.147l.423-.265c.26-.163.411-.363.451-.6.049-.236-.008-.483-.17-.743l-1.018-1.628-2.035 1.273 1.018 1.627Zm.08 9.416c-.236-.588-.307-1.156-.211-1.704.096-.549.358-1.05.787-1.502.432-.446 1.022-.82 1.77-1.12.749-.3 1.433-.44 2.054-.415.629.027 1.166.203 1.612.527.449.33.792.792 1.031 1.386.238.593.308 1.162.21 1.704-.096.548-.359 1.046-.791 1.492-.429.453-1.021.83-1.775 1.134-.749.3-1.435.435-2.057.405-.621-.024-1.155-.2-1.604-.53-.446-.324-.788-.783-1.026-1.377Zm.941-.367c.218.544.575.904 1.069 1.08.503.178 1.07.14 1.701-.113l1.067-.428c.631-.254 1.063-.618 1.296-1.092.242-.47.254-.978.035-1.523-.218-.544-.58-.909-1.086-1.094-.496-.181-1.06-.145-1.691.108l-1.067.429c-.631.253-1.067.618-1.306 1.095-.231.48-.237.993-.018 1.538Zm3.151 10.735-.977.215-.891-4.033 7.158-1.58.243 1.103-6.181 1.365.648 2.93Zm.648 7.207-.997.079-.323-4.118 7.307-.573.089 1.126-6.311.495.235 2.991Zm.714 9.425c.035-.238.122-.41.26-.518.136-.1.307-.136.511-.105l.158.024c.204.03.357.115.458.251.106.144.142.335.106.572-.035.23-.124.396-.267.496a.643.643 0 0 1-.513.115l-.158-.024a.685.685 0 0 1-.458-.25c-.1-.137-.133-.324-.097-.561Zm-5.881 11.323c.408-1.029 1.122-1.7 2.142-2.013l.365 1.005c-.781.236-1.316.716-1.603 1.441-.172.434-.204.805-.096 1.113.111.317.34.543.687.68.286.114.539.117.76.011.227-.103.457-.339.688-.706l.357-.547c.386-.614.801-1.027 1.243-1.24.447-.203.936-.199 1.469.012.601.238.991.64 1.169 1.205.178.565.123 1.21-.164 1.936-.393.991-1.044 1.612-1.953 1.861l-.341-.984c.656-.192 1.118-.626 1.386-1.301.162-.41.202-.756.121-1.039-.075-.28-.268-.482-.578-.605-.291-.115-.546-.116-.763-.001-.218.115-.445.354-.683.72l-.351.56c-.412.625-.835 1.03-1.268 1.218-.435.194-.919.185-1.452-.026a2.247 2.247 0 0 1-.998-.74 2.037 2.037 0 0 1-.399-1.137c-.027-.44.061-.915.262-1.423Zm-3.454 6.754c.484-.83 1.139-1.315 1.964-1.459.827-.134 1.765.105 2.812.717.703.41 1.241.864 1.615 1.36.37.502.569 1.028.596 1.576.027.549-.118 1.094-.434 1.635-.625 1.07-1.536 1.538-2.731 1.404l.025-1.074c.819.13 1.431-.149 1.834-.84.289-.495.343-.989.16-1.482-.181-.484-.573-.902-1.178-1.255l-.95-.555c-.598-.35-1.15-.483-1.654-.4-.502.093-.898.387-1.187.882-.212.363-.295.723-.25 1.082.042.364.193.707.453 1.029l-.934.508c-.342-.485-.53-.997-.563-1.534-.032-.527.109-1.06.422-1.594Zm-1.514 7.523-2.292-1.904.722-.87 5.638 4.685-2 2.407c-.413.498-.888.766-1.424.806-.536.04-1.063-.155-1.581-.585-.41-.34-.677-.718-.8-1.133-.119-.41-.077-.836.123-1.276l-3.4-.758.805-.969 3.244.759.965-1.162Zm-.488 2.09c-.196.236-.288.472-.276.708.013.245.138.465.374.661l.384.32c.236.195.473.275.711.24.239-.028.457-.16.653-.395l1.227-1.477-1.846-1.533-1.227 1.476Zm-8.918 3.025c.485-.408 1.002-.653 1.553-.733.551-.081 1.109.011 1.673.277.559.27 1.098.713 1.618 1.33.52.617.866 1.223 1.037 1.82.171.606.173 1.171.005 1.696-.173.53-.504 1.001-.993 1.413-.49.413-1.007.657-1.553.734-.55.081-1.106-.014-1.665-.284-.564-.266-1.108-.709-1.632-1.331-.52-.617-.863-1.226-1.03-1.826-.171-.597-.17-1.16.002-1.689.168-.525.496-.994.986-1.407Zm.644.779c-.449.378-.679.829-.69 1.353-.012.534.2 1.061.639 1.581l.741.879c.439.52.92.816 1.443.889.523.082 1.009-.065 1.457-.444.449-.378.682-.836.7-1.374.016-.528-.195-1.052-.633-1.572l-.742-.879c-.438-.52-.921-.82-1.45-.897-.528-.069-1.017.086-1.465.464Zm-9.207 6.355-.511-.86 3.55-2.109 3.744 6.302-.971.577-3.233-5.442-2.58 1.532Zm-6.642 2.874-.387-.922 3.81-1.597 2.833 6.76-1.042.437-2.447-5.838-2.767 1.16Zm-8.726 3.63c.237-.041.427-.012.573.085.138.098.225.249.26.452l.026.158c.035.204.004.375-.095.513-.103.147-.273.24-.51.28-.23.04-.414.007-.554-.098a.642.642 0 0 1-.27-.451l-.027-.157a.684.684 0 0 1 .095-.514c.098-.138.266-.228.502-.268Z"
        fill="var(--theme-text-15)"
      />
      <!-- Arrow (rotatable via direction prop) -->
      <path
        class="scroll-button__arrow"
        clip-rule="evenodd"
        d="m61.286 77.156 3.596-4.425c1.886-2.323 4.45-3.629 7.118-3.629L60 83.867 48 69.102c2.672 0 5.232 1.306 7.118 3.629l3.596 4.425V37h2.572v40.156Z"
        fill="var(--theme-text-40)"
        fill-rule="evenodd"
        :style="arrowStyle"
      />
    </svg>
  </div>
</template>

<script setup lang="ts">
/**
 * ScrollButtonSVG Component - Animated Scroll Indicator with Direction Control
 *
 * Features:
 * - Infinite rotation of circular text (viewport-aware with ScrollTrigger)
 * - Arrow direction controlled via prop (up, down, left, right)
 * - Theme-aware colors
 * - Responsive sizing
 * - Integrates with both entrance animations (first load) and page transitions
 *
 * Props:
 * @param {string} direction - Arrow direction: 'up' | 'down' | 'left' | 'right' (default: 'down')
 *
 * Performance:
 * - Rotation pauses when scrolled out of viewport (saves resources)
 * - Resumes when scrolled back into view
 * - Proper cleanup on unmount
 */

// Nuxt GSAP
const { $gsap, $ScrollTrigger } = useNuxtApp()

// Loading store for first load detection
const loadingStore = useLoadingStore()

// Props
const props = withDefaults(defineProps<{
  direction?: 'up' | 'down' | 'left' | 'right'
}>(), {
  direction: 'down'
})

// Refs
const containerRef = ref(null)
const textRef = ref(null)

// Rotation animation instance (stored for cleanup)
let rotationAnimation: gsap.core.Tween | null = null
let scrollTriggerInstance: ScrollTrigger | null = null

// Computed arrow rotation based on direction
const arrowStyle = computed(() => {
  const rotations: Record<string, string> = {
    down: '0deg',
    up: '180deg',
    left: '90deg',
    right: '-90deg'
  }
  return {
    transform: `rotate(${rotations[props.direction]})`,
    transformOrigin: '60px 60px'
  }
})

onMounted(() => {
  if (!textRef.value || !containerRef.value) return

  // Create infinite rotation animation (paused initially)
  rotationAnimation = $gsap.to(textRef.value, {
    rotation: 360,
    duration: 20,
    repeat: -1,
    ease: 'none',
    paused: true,
    transformOrigin: 'center center'
  })

  // ScrollTrigger: Pause/resume based on viewport visibility
  scrollTriggerInstance = $ScrollTrigger.create({
    trigger: containerRef.value,
    start: 'top bottom', // When top enters bottom of viewport
    end: 'bottom top', // When bottom leaves top of viewport
    onEnter: () => rotationAnimation?.resume(),
    onLeave: () => rotationAnimation?.pause(),
    onEnterBack: () => rotationAnimation?.resume(),
    onLeaveBack: () => rotationAnimation?.pause()
  })

  // Start rotation based on load type
  if (loadingStore.isFirstLoad) {
    // First load: wait for entrance animations to complete
    window.addEventListener(
      'app:complete',
      () => {
        rotationAnimation?.play()
      },
      { once: true }
    )
  }
  else {
    // Page navigation: delay for page transition to complete
    // setTimeout is simple and works reliably with v-page-fade timing
    setTimeout(() => {
      rotationAnimation?.play()
    }, 600) // Matches typical page transition duration
  }
})

onUnmounted(() => {
  // Clean up rotation animation
  if (rotationAnimation) {
    rotationAnimation.kill()
    rotationAnimation = null
  }

  // Clean up ScrollTrigger
  if (scrollTriggerInstance) {
    scrollTriggerInstance.kill()
    scrollTriggerInstance = null
  }
})
</script>

<style scoped>
/**
 * ScrollButtonSVG Component Styles
 *
 * This component represents a circular "Scroll" button with animated text and arrow.
 * The SVG is theme-aware and responsive.
 *
 * Features:
 * - Circular text path spelling "Scroll" (rotates via GSAP)
 * - Arrow indicator (direction controlled via prop)
 * - Hoverable interaction (via CursorTrail)
 * - Theme-aware colors using CSS variables
 * - Responsive sizing (24px mobile -> 28px tablet -> 32px desktop)
 *
 * IMPORTANT: No CSS transitions on this element - GSAP handles all animations
 */

.scroll-button {
  /* Container positioned at end (right alignment) */
  cursor: pointer;
  /* NO transition property - conflicts with GSAP animations */
}

.scroll-button__text {
  /* Transform origin set via GSAP for rotation */
  transform-origin: center center;
}
</style>
