@use "../tokens/breakpoints.scss" as bp;

/* ============================================
   Interactive Case Study Section
   ============================================

   Responsive case study gallery with hover previews.
   Two layouts: list (desktop) and cards (mobile).

   Desktop (â‰¥768px):
   - Two-column list layout (title left, description right)
   - Hover reveals centrally positioned preview image
   - Clip-path reveal animation
   - Subtle theme-aware background on hover

   Mobile (<768px):
   - Card layout with images
   - Stacked vertically
   - Touch-friendly interactions

   Theme Integration:
   - Uses CSS custom properties for colors
   - Adapts to light/dark theme automatically
   - Smooth transitions using design tokens

   Entrance Animation:
   - Optional entrance animation system support (via data-entrance-animate)
   - Default scroll-triggered animation when entering viewport
   - CSS hides elements on first load to prevent FOUC
*/

/* ============================================
   ENTRANCE ANIMATION HIDING (FIRST LOAD ONLY)
   ============================================ */

/* Hide section elements on first load when entrance animation is enabled */
/* This prevents FOUC (Flash Of Unstyled Content) before animations run */
/* Only applies when html.is-first-load class exists (removed after first load) */
html.is-first-load [data-entrance-animate="true"] {
  .section-title {
    opacity: 0;
    visibility: hidden;
  }

  .case-study-item {
    opacity: 0;
    visibility: hidden;
  }
}

/* ============================================
   SECTION CONTAINER
   ============================================ */

/* Main section - transparent to show parent background (FluidGradient) */
.interactive-case-study-section {
  /* Transparent - allows FluidGradient or other backgrounds to show through */
  background: transparent;
  align-content: start;
  /* Position relative for absolute-positioned preview */
  position: relative;
}

/* Section title */
.section-title {
  color: var(--theme-text-60);
  font-size: var(--step-2); /* Fluid 12-16px */
  font-weight: 400;
  letter-spacing: 0.02em;
}

/* Container for list items */
.case-study-list {
  display: flex;
  flex-direction: column;
  position: relative;
  z-index: 1;
}

/* ============================================
   DESKTOP HOVER PREVIEW (Phase 2.1: Scroll Support)
   ============================================ */

/* Preview container - positioned by GSAP, follows cursor */
.preview-container {
  /* Fixed positioning + Teleport to body for scroll support */
  /* Works with ScrollSmoother since it's outside smooth-content */
  position: fixed;
  top: 0;
  left: 0;

  /* Size constraints */
  width: 35vw;
  // height: 100%;
  max-width: 30em;
  max-height: 80vh;
  /* Dynamic aspect ratio set via inline style (based on actual image dimensions) */
  /* Default 4:3 fallback set in composable, smoothly animated between images */

  /* Transform from top-left corner (not center) */
  /* CRITICAL: Without this, GSAP's default 50% 50% origin positions center instead of top-left */
  transform-origin: 0 0;

  /* Non-interactive (allows clicks to pass through to list) */
  pointer-events: none;

  /* Above list items */
  z-index: 10;

  /* Performance optimization for smooth cursor following */
  will-change: transform;
}

/* Dual-image wrapper - enables crossfade transitions */
.preview-image-wrapper {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;

  /* Opacity fully controlled by GSAP (no CSS opacity to avoid conflicts) */
  /* Clip-path for initial reveal handled by GSAP */
}

/* Preview image */
.preview-image {
  width: 100%;
  height: 100%;
  object-fit: cover;
  border-radius: 0.5rem;

  /* Performance optimization for parallax */
  will-change: transform;
}

/* ============================================
   DESKTOP LIST ITEM
   ============================================ */

/* Items are nested full-width-content (inside list which is also full-width-content) */
/* Need explicit rule since content-grid.scss only handles direct children */
/* IMPORTANT: Only apply on desktop to respect Tailwind's 'hidden' class on mobile */
@include bp.up(bp.$bp-md) {
  .full-width-content > .case-study-item.full-width-content {
    grid-column: full-width;
    display: grid !important; /* Override Tailwind md:block */
    grid-template-columns: inherit;
  }
}

.case-study-item {
  /* Remove link styling */
  text-decoration: none;

  /* Vertical spacing - top and bottom padding (border has no margin) */
  padding: var(--space-s) 0; /* Fluid 18-22px top and bottom */

  /* Smooth background transition on hover */
  background: transparent;
  transition: background-color var(--duration-hover) var(--ease-power2);
}

.case-study-item:hover {
  /* Full-width solid background on hover (theme-aware) */
  /* Light theme: white, Dark theme: black */
  background-color: var(--theme-100);
}

/* Content wrapper - uses breakout3 class within sub-grid */
.item-content {
  /* breakout3 class handles grid-column placement */
  /* Manual grid for internal two-column layout */
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: var(--space-m); /* Fluid 27-33px */
}

/* Left column: Title + Tag */
.item-title-col {
  display: flex;
  align-items: baseline;
  gap: var(--space-m); /* Fluid 9-11px */
  flex-wrap: wrap;
}

.item-title {
  color: var(--theme-text-100);
}

.item-tag {
  color: var(--theme-text-60);
  text-transform: uppercase;
  letter-spacing: 0.05em;
  align-self: center;
  margin-bottom: 1em;
}

/* Right column: Description */
.item-description-col {
  display: flex;
  align-items: center;
  justify-content: flex-end;
  text-align: right;
}

.item-description {
  color: var(--theme-text-40);
}

/* ============================================
   MOBILE CARD
   ============================================ */

.case-study-card {
  flex-direction: column;
  gap: var(--space-2xs); /* Fluid 9-11px */
  margin-bottom: var(--space-s); /* Fluid 18-22px */
  text-decoration: none;
  overflow: hidden;
}

/* Card image container - square (1:1) for mobile */
.card-image-container {
  width: 100%;
  aspect-ratio: 1 / 1; /* Square aspect ratio (320x320 in design, scales responsively) */
  overflow: hidden;
  border-radius: 0.5rem;
}

.card-image {
  width: 100%;
  height: 100%;
  object-fit: cover;

  /* Subtle scale on touch/active */
  transition: transform var(--duration-hover) var(--ease-power2);
}

.case-study-card:active .card-image {
  transform: scale(1.05);
}

/* Card content section */
.card-content {
  display: flex;
  flex-direction: column;
  gap: var(--space-3xs); /* Fluid 5-6px */
}

/* Card header: Title + Tag */
.card-header {
  display: flex;
  align-items: baseline;
  gap: var(--space-s-m); /* Fluid 5-11px */
  flex-wrap: wrap;
}

.card-title {
  color: var(--theme-text-100);
}

.card-tag {
  color: var(--theme-text-60);
  text-transform: uppercase;
  letter-spacing: 0.05em;
  align-self: center;
}

.card-description {
  color: var(--theme-text-40);
}

/* ============================================
   PREVIEW FADE TRANSITION
   ============================================ */

/* Smooth fade transition for preview visibility */
.preview-fade-enter-active,
.preview-fade-leave-active {
  transition: opacity 0.3s ease;
}

.preview-fade-enter-from,
.preview-fade-leave-to {
  opacity: 0;
}

/* ============================================
   RESPONSIVE ADJUSTMENTS
   ============================================ */

/* Desktop adjustments for larger screens */
@include bp.up(bp.$bp-lg) {
  /* Larger preview on bigger screens */
  .preview-container {
    width: 40vw;
    max-width: 40em;
  }

  /* More generous spacing */
  .case-study-item {
    padding: var(--space-m) 0; /* Fluid 27-33px top and bottom */
  }

  .item-content {
    gap: var(--space-l); /* Fluid 36-44px */
  }
}

/* Extra large screens */
@include bp.up(bp.$bp-2xl) {
  .item-content {
    gap: var(--space-xl); /* Fluid 54-66px */
  }
}
